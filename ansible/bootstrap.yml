---

- hosts: 127.0.0.1
  connection: local
  remote_user: "{{ lookup('env', 'USER') }}"

  vars:
    username: "{{ ansible_facts['user_id'] }}"
    cwd: "{{ lookup('env', 'PWD') }}"
    home: "{{ ansible_facts['user_dir'] }}"
    local_bin: "{{ home }}/.local/bin"

  post_tasks:

    - name: create directories
      file:
        path: "{{ local_bin }}"
        state: directory

    # symlink dotfiles
    - name: git
      file:
        src: "{{ cwd }}/git/.gitconfig"
        dest: "{{ home }}/.gitconfig"
        state: link

    - name: tmux
      file:
        src: "{{ cwd }}/tmux/.tmux.conf"
        dest: "{{ home }}/.tmux.conf"
        state: link

    - name: vim
      file:
        src: "{{ cwd }}/vim/.vimrc"
        dest: "{{ home }}/.vimrc"
        state: link

    - name: zsh
      file:
        src: "{{ cwd }}/zsh/.zshrc"
        dest: "{{ home }}/.zshrc"
        state: link

    # Z shell
    - name: install
      apt: name=zsh state=present
      become: yes

    - name: make default shell
      user: name={{ username }} shell=/usr/bin/zsh
      become: yes

    # NeoVim
    - name: download
      get_url:
        url: https://github.com/neovim/neovim/releases/download/v0.3.3/nvim.appimage
        dest: "{{ local_bin }}/nvim"

    - name: make executable
      file: dest="{{ local_bin }}/nvim" mode=u+x

